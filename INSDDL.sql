-- DATOS.sql
-- Inserts for FACULTAD
INSERT INTO FACULTAD (ID_FACULTAD, NOMBRE_FACULTAD) VALUES ('FAC001', 'Facultad de Ingeniería');
INSERT INTO FACULTAD (ID_FACULTAD, NOMBRE_FACULTAD) VALUES ('FAC002', 'Facultad de Ciencias Sociales y Humanas');
INSERT INTO FACULTAD (ID_FACULTAD, NOMBRE_FACULTAD) VALUES ('FAC003', 'Facultad de Ciencias Económicas y Administrativas');

-- Inserts for PROGRAMA_ACADEMICO
INSERT INTO PROGRAMA_ACADEMICO (ID_PROGRAMA_ACADEMICO, ID_FACULTAD, NOMBRE_PROGRAMA, NIVEL_FORMACION, CODIGO_SNIES) VALUES ('PROG001', 'FAC001', 'Ingeniería de Software', 'Profesional Universitario', 'SNIES1001');
INSERT INTO PROGRAMA_ACADEMICO (ID_PROGRAMA_ACADEMICO, ID_FACULTAD, NOMBRE_PROGRAMA, NIVEL_FORMACION, CODIGO_SNIES) VALUES ('PROG002', 'FAC001', 'Ingeniería Industrial', 'Profesional Universitario', 'SNIES1002');
INSERT INTO PROGRAMA_ACADEMICO (ID_PROGRAMA_ACADEMICO, ID_FACULTAD, NOMBRE_PROGRAMA, NIVEL_FORMACION, CODIGO_SNIES) VALUES ('PROG003', 'FAC002', 'Psicología', 'Profesional Universitario', 'SNIES2001');
INSERT INTO PROGRAMA_ACADEMICO (ID_PROGRAMA_ACADEMICO, ID_FACULTAD, NOMBRE_PROGRAMA, NIVEL_FORMACION, CODIGO_SNIES) VALUES ('PROG004', 'FAC003', 'Administración de Empresas', 'Profesional Universitario', 'SNIES3001');

-- Inserts for ESTUDIANTE
INSERT INTO ESTUDIANTE (ID_ESTUDIANTE, ID_PROGRAMA_ACADEMICO, NOMBRES, APELLIDOS, TIPO_DOCUMENTO_IDENTIDAD, NUMERO_DOCUMENTO_IDENTIDAD, CORREO_INSTITUCIONAL, TELEFONO, CREDITOS_APROBADOS, ESTADO_ACADEMICO_GENERAL) VALUES ('EST001', 'PROG001', 'Ana', 'Pérez', 'CC', 1000000001, 'ana.perez@university.edu.co', '3000000001', 120.5, 'Activo');
INSERT INTO ESTUDIANTE (ID_ESTUDIANTE, ID_PROGRAMA_ACADEMICO, NOMBRES, APELLIDOS, TIPO_DOCUMENTO_IDENTIDAD, NUMERO_DOCUMENTO_IDENTIDAD, CORREO_INSTITUCIONAL, TELEFONO, CREDITOS_APROBADOS, ESTADO_ACADEMICO_GENERAL) VALUES ('EST002', 'PROG002', 'Luis', 'Gomez', 'CC', 1000000002, 'luis.gomez@university.edu.co', '3000000002', 150, 'Activo');
INSERT INTO ESTUDIANTE (ID_ESTUDIANTE, ID_PROGRAMA_ACADEMICO, NOMBRES, APELLIDOS, TIPO_DOCUMENTO_IDENTIDAD, NUMERO_DOCUMENTO_IDENTIDAD, CORREO_INSTITUCIONAL, TELEFONO, CREDITOS_APROBADOS, ESTADO_ACADEMICO_GENERAL) VALUES ('EST003', 'PROG001', 'Maria', 'Lopez', 'TI', 1000000003, 'maria.lopez@university.edu.co', '3000000003', 80, 'Activo');
INSERT INTO ESTUDIANTE (ID_ESTUDIANTE, ID_PROGRAMA_ACADEMICO, NOMBRES, APELLIDOS, TIPO_DOCUMENTO_IDENTIDAD, NUMERO_DOCUMENTO_IDENTIDAD, CORREO_INSTITUCIONAL, TELEFONO, CREDITOS_APROBADOS, ESTADO_ACADEMICO_GENERAL) VALUES ('EST004', 'PROG004', 'Carlos', 'Ruiz', 'CC', 1000000004, 'carlos.ruiz@university.edu.co', '3000000004', 160, 'Graduado');

-- Inserts for OPCION_GRADO
INSERT INTO OPCION_GRADO (ID_OPCION_GRADO, NOMBRE_OPCION_GRADO, DESCRIPCION_OPCION, DURACION_ESTIMADA_PERIODOS) VALUES ('OPC001', 'Proyecto de Investigación', 'Desarrollo de un proyecto de investigación original.', 2);
INSERT INTO OPCION_GRADO (ID_OPCION_GRADO, NOMBRE_OPCION_GRADO, DESCRIPCION_OPCION, DURACION_ESTIMADA_PERIODOS) VALUES ('OPC002', 'Práctica Profesional', 'Desempeño profesional en una empresa.', 1);
INSERT INTO OPCION_GRADO (ID_OPCION_GRADO, NOMBRE_OPCION_GRADO, DESCRIPCION_OPCION, DURACION_ESTIMADA_PERIODOS) VALUES ('OPC003', 'Monografía', 'Trabajo escrito sobre un tema específico.', 1);
INSERT INTO OPCION_GRADO (ID_OPCION_GRADO, NOMBRE_OPCION_GRADO, DESCRIPCION_OPCION, DURACION_ESTIMADA_PERIODOS) VALUES ('OPC004', 'Diplomado', 'Curso de profundización.', 1);

-- Inserts for ESTADO_TRABAJO_GRADO
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG001', 'Propuesto');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG002', 'Aprobado');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG003', 'En desarrollo');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG004', 'Entregado');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG005', 'Sustentado');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG006', 'Calificado');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG007', 'Meritorio');
INSERT INTO ESTADO_TRABAJO_GRADO (ID_ESTADO_TG, NOMBRE_ESTADO) VALUES ('ETG008', 'Laureado');

-- Inserts for TRABAJO_GRADO
INSERT INTO TRABAJO_GRADO (ID_TRABAJO_GRADO, ID_ESTADO_TG, ID_OPCION_GRADO, TITULO_GRADO, FECHA_REGISTRO_PROPUESTA, FECHA_APROBACION_PROPUESTA, FECHA_INICIO_DESARROLLO, FECHA_LIMITE_ENTREGA_ESTIMADA, FECHA_ENTREGA_FINAL, FECHA_SUSTENTACION, CALIFICACION_FINAL, MENCION_HONORIFICA, OBSERVACIONES_GENERALES) VALUES ('TG001', 'ETG003', 'OPC001', 'Sistema de Gestión Académica', TO_DATE('2024-01-15', 'YYYY-MM-DD'), TO_DATE('2024-02-01', 'YYYY-MM-DD'), TO_DATE('2024-02-15', 'YYYY-MM-DD'), TO_DATE('2024-08-15', 'YYYY-MM-DD'), TO_DATE('2024-08-10', 'YYYY-MM-DD'), TO_DATE('2024-09-01', 'YYYY-MM-DD'), 4.5, 'Ninguna', EMPTY_CLOB());
INSERT INTO TRABAJO_GRADO (ID_TRABAJO_GRADO, ID_ESTADO_TG, ID_OPCION_GRADO, TITULO_GRADO, FECHA_REGISTRO_PROPUESTA, FECHA_APROBACION_PROPUESTA, FECHA_INICIO_DESARROLLO, FECHA_LIMITE_ENTREGA_ESTIMADA, FECHA_ENTREGA_FINAL, FECHA_SUSTENTACION, CALIFICACION_FINAL, MENCION_HONORIFICA, OBSERVACIONES_GENERALES) VALUES ('TG002', 'ETG006', 'OPC002', 'Optimización de Procesos en ABC Corp', TO_DATE('2023-06-01', 'YYYY-MM-DD'), TO_DATE('2023-06-15', 'YYYY-MM-DD'), TO_DATE('2023-07-01', 'YYYY-MM-DD'), TO_DATE('2023-12-01', 'YYYY-MM-DD'), TO_DATE('2023-11-20', 'YYYY-MM-DD'), TO_DATE('2023-12-10', 'YYYY-MM-DD'), 4.8, 'Meritorio', EMPTY_CLOB());
INSERT INTO TRABAJO_GRADO (ID_TRABAJO_GRADO, ID_ESTADO_TG, ID_OPCION_GRADO, TITULO_GRADO, FECHA_REGISTRO_PROPUESTA, FECHA_APROBACION_PROPUESTA, FECHA_INICIO_DESARROLLO, FECHA_LIMITE_ENTREGA_ESTIMADA, FECHA_ENTREGA_FINAL, FECHA_SUSTENTACION, CALIFICACION_FINAL, MENCION_HONORIFICA, OBSERVACIONES_GENERALES) VALUES ('TG003', 'ETG001', 'OPC003', 'Impacto de las Redes Sociales en Jóvenes', TO_DATE('2024-03-01', 'YYYY-MM-DD'), TO_DATE('2024-03-15', 'YYYY-MM-DD'), TO_DATE('2024-04-01', 'YYYY-MM-DD'), TO_DATE('2024-07-01', 'YYYY-MM-DD'), TO_DATE('2024-06-25', 'YYYY-MM-DD'), TO_DATE('2024-07-15', 'YYYY-MM-DD'), 0.0, 'Ninguna', EMPTY_CLOB()); -- Calificacion 0.0 para no calificado

-- Inserts for EST_TRBJO_GRA (Junction table for Estudiante and Trabajo_Grado)
INSERT INTO EST_TRBJO_GRA (ID_ESTUDIANTE, ID_TRABAJO_GRADO, ROL_ESTUDIANTE) VALUES ('EST001', 'TG001', 'Autor Principal');
INSERT INTO EST_TRBJO_GRA (ID_ESTUDIANTE, ID_TRABAJO_GRADO, ROL_ESTUDIANTE) VALUES ('EST002', 'TG002', 'Autor Único');
INSERT INTO EST_TRBJO_GRA (ID_ESTUDIANTE, ID_TRABAJO_GRADO, ROL_ESTUDIANTE) VALUES ('EST003', 'TG003', 'Autor Principal');
INSERT INTO EST_TRBJO_GRA (ID_ESTUDIANTE, ID_TRABAJO_GRADO, ROL_ESTUDIANTE) VALUES ('EST004', 'TG001', 'Colaborador'); -- Suponiendo que un trabajo puede tener varios estudiantes

-- Inserts for DOCENTE
INSERT INTO DOCENTE (ID_DOCENTE, NOMBRES_DOCENTE, APELLIDOS_DOCENTE, EMAIL_DOCENTE, TIPO_VINCULACION, AREA_ESPECIALIZACION) VALUES ('DOC001', 'Carlos', 'Santos', 'carlos.santos@university.edu.co', 'Planta', 'Ingeniería de Software');
INSERT INTO DOCENTE (ID_DOCENTE, NOMBRES_DOCENTE, APELLIDOS_DOCENTE, EMAIL_DOCENTE, TIPO_VINCULACION, AREA_ESPECIALIZACION) VALUES ('DOC002', 'Laura', 'Nuñez', 'laura.nunez@university.edu.co', 'Catedrático', 'Gestión de Proyectos');
INSERT INTO DOCENTE (ID_DOCENTE, NOMBRES_DOCENTE, APELLIDOS_DOCENTE, EMAIL_DOCENTE, TIPO_VINCULACION, AREA_ESPECIALIZACION) VALUES ('DOC003', 'Pedro', 'Morales', 'pedro.morales@university.edu.co', 'Planta', 'Psicología Organizacional');

-- Inserts for ASIGNACION_ASESOR
INSERT INTO ASIGNACION_ASESOR (ID_ASIGNACION_ASESOR, ID_DOCENTE, ID_TRABAJO_GRADO, TIPO_ASESOR, ESTADO_ASESORIA, FECHA_ASIGNACION_ASESOR) VALUES ('AA001', 'DOC001', 'TG001', 'Principal', 'Activa', TO_DATE('2024-02-05', 'YYYY-MM-DD'));
INSERT INTO ASIGNACION_ASESOR (ID_ASIGNACION_ASESOR, ID_DOCENTE, ID_TRABAJO_GRADO, TIPO_ASESOR, ESTADO_ASESORIA, FECHA_ASIGNACION_ASESOR) VALUES ('AA002', 'DOC002', 'TG002', 'Metodológico', 'Finalizada', TO_DATE('2023-06-20', 'YYYY-MM-DD'));

-- Inserts for ASIGNACION_JURADO
INSERT INTO ASIGNACION_JURADO (ID_ASIGNACION_JURADO, ID_TRABAJO_GRADO, ID_DOCENTE, FECHA_ASIGNACION_JURADO, ROL_JURADO, FECHA_CONCEPTO, CONCEPTO_EMITIDO) VALUES ('AJ001', 'TG001', 'DOC002', TO_DATE('2024-08-15', 'YYYY-MM-DD'), 'Principal', TO_DATE('2024-08-25', 'YYYY-MM-DD'), 'Aprobado con observaciones');
INSERT INTO ASIGNACION_JURADO (ID_ASIGNACION_JURADO, ID_TRABAJO_GRADO, ID_DOCENTE, FECHA_ASIGNACION_JURADO, ROL_JURADO, FECHA_CONCEPTO, CONCEPTO_EMITIDO) VALUES ('AJ002', 'TG001', 'DOC003', TO_DATE('2024-08-15', 'YYYY-MM-DD'), 'Suplente', TO_DATE('2024-08-26', 'YYYY-MM-DD'), 'Aprobado');
INSERT INTO ASIGNACION_JURADO (ID_ASIGNACION_JURADO, ID_TRABAJO_GRADO, ID_DOCENTE, FECHA_ASIGNACION_JURADO, ROL_JURADO, FECHA_CONCEPTO, CONCEPTO_EMITIDO) VALUES ('AJ003', 'TG002', 'DOC001', TO_DATE('2023-11-25', 'YYYY-MM-DD'), 'Principal', TO_DATE('2023-12-05', 'YYYY-MM-DD'), 'Aprobado con recomendación de mención');

-- Inserts for CONCEJO_FACULTAD
INSERT INTO CONCEJO_FACULTAD (ID_CONSEJO, NOMBRE_CONSEJO, FECHA_SESION_ACTA, NUMERO_ACTA) VALUES ('CF001', 'Consejo Facultad Ingeniería', TO_DATE('2024-01-30', 'YYYY-MM-DD'), 'ACTA-CF-ING-2024-001');
INSERT INTO CONCEJO_FACULTAD (ID_CONSEJO, NOMBRE_CONSEJO, FECHA_SESION_ACTA, NUMERO_ACTA) VALUES ('CF002', 'Consejo Facultad Ciencias Sociales', TO_DATE('2024-02-15', 'YYYY-MM-DD'), 'ACTA-CF-CSH-2024-001');

-- Inserts for EMPRESA
INSERT INTO EMPRESA (ID_EMPRESA, NIT_EMPRESA, NOMBRE_EMPRESA, DIRECCION_EMPRESA, TELEFONO_EMPRESA, EMAIL_CONTACTO_EMPRESA) VALUES ('EMP001', '900000001-1', 'Tech Solutions S.A.S.', 'Calle Falsa 123', '6010000001', 'contacto@techsolutions.com');
INSERT INTO EMPRESA (ID_EMPRESA, NIT_EMPRESA, NOMBRE_EMPRESA, DIRECCION_EMPRESA, TELEFONO_EMPRESA, EMAIL_CONTACTO_EMPRESA) VALUES ('EMP002', '900000002-2', 'Innovatec Ltda.', 'Avenida Siempre Viva 742', '6010000002', 'info@innovatec.co');

-- Inserts for CONVENIO
INSERT INTO CONVENIO (ID_CONVENIO, ID_EMPRESA, ID_PROGRAMA_ACADEMICO, OBJETO_CONVENIO, FECHA_FORMALIZACION, FECHA_INICIO_VIGENCIA, FECHA_FIN_VIGENCIA, PERSONA_CONTACTO_CONVENIO, DOCUMENTO_CONVENIO_ADJUNTO) VALUES ('CONV001', 'EMP001', 'PROG001', EMPTY_CLOB() || 'Convenio marco para prácticas profesionales en desarrollo de software.', TO_DATE('2023-01-20', 'YYYY-MM-DD'), TO_DATE('2023-02-01', 'YYYY-MM-DD'), TO_DATE('2025-01-31', 'YYYY-MM-DD'), 'Juan Valdez', EMPTY_BLOB());
INSERT INTO CONVENIO (ID_CONVENIO, ID_EMPRESA, ID_PROGRAMA_ACADEMICO, OBJETO_CONVENIO, FECHA_FORMALIZACION, FECHA_INICIO_VIGENCIA, FECHA_FIN_VIGENCIA, PERSONA_CONTACTO_CONVENIO, DOCUMENTO_CONVENIO_ADJUNTO) VALUES ('CONV002', 'EMP002', 'PROG002', EMPTY_CLOB() || 'Convenio para pasantías en el área de optimización industrial.', TO_DATE('2022-11-10', 'YYYY-MM-DD'), TO_DATE('2022-12-01', 'YYYY-MM-DD'), TO_DATE('2024-11-30', 'YYYY-MM-DD'), 'Luisa Lane', EMPTY_BLOB());

-- Inserts for HIST_ESTDO_TRBJO_GRA
INSERT INTO HIST_ESTDO_TRBJO_GRA (ID_HISTORIAL, ID_ESTADO_TG, ID_TRABAJO_GRADO, FECHA_CAMBIO_ESTADO, OBSERVACION_CAMBIO) VALUES ('HIST001', 'ETG001', 'TG001', TO_DATE('2024-01-15', 'YYYY-MM-DD'), 'Propuesta registrada');
INSERT INTO HIST_ESTDO_TRBJO_GRA (ID_HISTORIAL, ID_ESTADO_TG, ID_TRABAJO_GRADO, FECHA_CAMBIO_ESTADO, OBSERVACION_CAMBIO) VALUES ('HIST002', 'ETG002', 'TG001', TO_DATE('2024-02-01', 'YYYY-MM-DD'), 'Propuesta aprobada por consejo');
INSERT INTO HIST_ESTDO_TRBJO_GRA (ID_HISTORIAL, ID_ESTADO_TG, ID_TRABAJO_GRADO, FECHA_CAMBIO_ESTADO, OBSERVACION_CAMBIO) VALUES ('HIST003', 'ETG003', 'TG001', TO_DATE('2024-02-15', 'YYYY-MM-DD'), 'Inicio desarrollo');
INSERT INTO HIST_ESTDO_TRBJO_GRA (ID_HISTORIAL, ID_ESTADO_TG, ID_TRABAJO_GRADO, FECHA_CAMBIO_ESTADO, OBSERVACION_CAMBIO) VALUES ('HIST004', 'ETG006', 'TG002', TO_DATE('2023-12-10', 'YYYY-MM-DD'), 'Trabajo calificado satisfactoriamente');

-- Inserts for DEC_CONJO_TRBJO_GRA
INSERT INTO DEC_CONJO_TRBJO_GRA (ID_DECISION, ID_CONSEJO, ID_HISTORIAL, ID_CONVENIO, ID_TRABAJO_GRADO, TIPO_DECISION, FECHA_DECISION, DETALLE_DECISION) VALUES ('DEC001', 'CF001', 'HIST002', NULL, 'TG001', 'Aprobación Propuesta', TO_DATE('2024-02-01', 'YYYY-MM-DD'), 'Se aprueba la propuesta de trabajo de grado.');
INSERT INTO DEC_CONJO_TRBJO_GRA (ID_DECISION, ID_CONSEJO, ID_HISTORIAL, ID_CONVENIO, ID_TRABAJO_GRADO, TIPO_DECISION, FECHA_DECISION, DETALLE_DECISION) VALUES ('DEC002', 'CF001', NULL, 'CONV001', 'TG002', 'Aprobación Práctica', TO_DATE('2023-06-15', 'YYYY-MM-DD'), 'Se aprueba inicio de práctica bajo convenio CONV001.');

-- Inserts for DETALLE_PRACTICA_PROFESIONAL
INSERT INTO DETALLE_PRACTICA_PROFESIONAL (ID_DET_PRACT_PRO, ID_CONVENIO, ID_EMPRESA, ID_TRABAJO_GRADO, NOMBRE_JEFE_INMEDIATO_PRACTICA, CARGO_JEFE_INMEDIATO_PRACTICA, CONSTANCIA_ARL_ADJUNTA, FECHA_INICIO_PRACTICA, FECHA_FIN_PRACTICA) VALUES ('DPP001', 'CONV001', 'EMP001', 'TG002', 'Pedro Pascal', 'Gerente de Proyectos', EMPTY_BLOB(), TO_DATE('2023-07-01', 'YYYY-MM-DD'), TO_DATE('2023-12-01', 'YYYY-MM-DD'));

-- Inserts for DOC_ADJ_TRBJO_GRA
INSERT INTO DOC_ADJ_TRBJO_GRA (ID_DOCUMENTO_ADJUNTO, ID_TRABAJO_GRADO, NOMBRE_DOCUMENTO, TIPO_DOCUMENTO, ARCHIVO_ADJUNTO, FECHA_CARGA, DESCRIPCION_DOCUMENTO) VALUES ('DOCADJ001', 'TG001', 'Anteproyecto_TG001.pdf', 'Anteproyecto', EMPTY_BLOB(), TO_DATE('2024-01-15', 'YYYY-MM-DD'), 'Documento inicial de la propuesta.');
INSERT INTO DOC_ADJ_TRBJO_GRA (ID_DOCUMENTO_ADJUNTO, ID_TRABAJO_GRADO, NOMBRE_DOCUMENTO, TIPO_DOCUMENTO, ARCHIVO_ADJUNTO, FECHA_CARGA, DESCRIPCION_DOCUMENTO) VALUES ('DOCADJ002', 'TG001', 'Informe_Final_TG001.pdf', 'Informe Final', EMPTY_BLOB(), TO_DATE('2024-08-10', 'YYYY-MM-DD'), 'Versión final del trabajo de grado.');
INSERT INTO DOC_ADJ_TRBJO_GRA (ID_DOCUMENTO_ADJUNTO, ID_TRABAJO_GRADO, NOMBRE_DOCUMENTO, TIPO_DOCUMENTO, ARCHIVO_ADJUNTO, FECHA_CARGA, DESCRIPCION_DOCUMENTO) VALUES ('DOCADJ003', 'TG002', 'Constancia_ARL_TG002.pdf', 'ARL', EMPTY_BLOB(), TO_DATE('2023-06-28', 'YYYY-MM-DD'), 'Certificado ARL para práctica.');


/*==============================================================*/
/* REGLAS DE NEGOCIO                                            */
/*==============================================================*/

-- Validación de créditos mínimos
CREATE OR REPLACE TRIGGER trg_check_creditos_estudiante_tg
BEFORE INSERT ON EST_TRBJO_GRA
FOR EACH ROW
DECLARE
    v_creditos_aprobados ESTUDIANTE.CREDITOS_APROBADOS%TYPE;
    MIN_CREDITOS_REQUERIDOS NUMBER := 100;
BEGIN
    SELECT E.CREDITOS_APROBADOS INTO v_creditos_aprobados
    FROM ESTUDIANTE E
    WHERE E.ID_ESTUDIANTE = :NEW.ID_ESTUDIANTE;

    IF v_creditos_aprobados < MIN_CREDITOS_REQUERIDOS THEN
        RAISE_APPLICATION_ERROR(-20001, 'El estudiante ' || :NEW.ID_ESTUDIANTE ||
        ' no cumple con los créditos mínimos requeridos (' || v_creditos_aprobados ||
        ' de ' || MIN_CREDITOS_REQUERIDOS || ') para iniciar un trabajo de grado.');
    END IF;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20002, 'Estudiante (' || :NEW.ID_ESTUDIANTE ||
        ') no encontrado para la validación de créditos.');
END;

-- Validación de fechas de concepto
-- Restricción CHECK para fechas:
ALTER TABLE ASIGNACION_JURADO
ADD CONSTRAINT CHK_FECHA_CONCEPTO_JURADO
CHECK (FECHA_CONCEPTO >= FECHA_ASIGNACION_JURADO);

-- Trigger alternativo con mensaje explícito:
CREATE OR REPLACE TRIGGER trg_check_fecha_concepto_jurado
BEFORE INSERT OR UPDATE ON ASIGNACION_JURADO
FOR EACH ROW
BEGIN
    IF :NEW.FECHA_CONCEPTO IS NOT NULL AND :NEW.FECHA_ASIGNACION_JURADO IS NOT NULL THEN
        IF :NEW.FECHA_CONCEPTO < :NEW.FECHA_ASIGNACION_JURADO THEN
            RAISE_APPLICATION_ERROR(-20003, 'La fecha de emisión del concepto (' ||
            TO_CHAR(:NEW.FECHA_CONCEPTO, 'YYYY-MM-DD') ||
            ') no puede ser anterior a la fecha de asignación del jurado (' ||
            TO_CHAR(:NEW.FECHA_ASIGNACION_JURADO, 'YYYY-MM-DD') || ').');
        END IF;
    END IF;
END;


-- Regla 3: Formato de NIT de empresa
-- Restricción CHECK para formato de NIT:

ALTER TABLE EMPRESA
ADD CONSTRAINT CHK_FORMATO_NIT_EMPRESA
CHECK (REGEXP_LIKE(NIT_EMPRESA, '^[0-9]+-[0-9]$'));



COMMIT;